<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - SmartTriage AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .tab-button {
            transition: all 0.3s ease;
        }
        .tab-button.active {
            background: rgba(255, 255, 255, 0.2);
            border-bottom: 2px solid #3b82f6;
        }
        .form-section {
            display: none;
        }
        .form-section.active {
            display: block;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-md">
        <!-- Login Card -->
        <div class="glass-effect rounded-2xl shadow-2xl p-8">
            <!-- Logo and Title -->
            <div class="text-center mb-8">
                <div class="inline-flex items-center justify-center w-16 h-16 bg-blue-600 rounded-full mb-4">
                    <i class="fas fa-heartbeat text-white text-2xl"></i>
                </div>
                <h1 class="text-3xl font-bold text-gray-900 mb-2">SmartTriage AI</h1>
                <p class="text-gray-600">Staff Portal Login</p>
            </div>

            <!-- Login Tabs -->
            <div class="mb-6">
                <div class="flex space-x-1 mb-4">
                    <button onclick="switchTab('demo')" id="demo-tab" 
                            class="tab-button active px-4 py-2 text-sm font-medium text-white rounded-lg">
                        <i class="fas fa-key mr-2"></i>Demo Login
                    </button>
                    <button onclick="switchTab('custom')" id="custom-tab" 
                            class="tab-button px-4 py-2 text-sm font-medium text-gray-300 rounded-lg">
                        <i class="fas fa-user-plus mr-2"></i>Custom Login
                    </button>
                </div>
            </div>

            <!-- Demo Login Section -->
            <div id="demo-section" class="form-section active">
                <h3 class="text-lg font-semibold text-gray-900 mb-4 text-center">
                    <i class="fas fa-key mr-2"></i>Quick Login - Demo Accounts
                </h3>
                <form action="/auth/login" method="POST" class="space-y-4">
                    {% if error %}
                    <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg">
                        <div class="flex items-center">
                            <i class="fas fa-exclamation-circle mr-2"></i>
                            <span>{{ error }}</span>
                        </div>
                    </div>
                    {% endif %}

                    <div class="flex items-center space-x-2 mb-4">
                        <div class="flex items-center">
                            <label class="block text-sm font-medium text-gray-700 mr-2">
                                <i class="fas fa-user mr-1"></i> Select Role:
                            </label>
                            <select id="demo-role" onchange="handleDemoRoleChange()" 
                                    class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                                <option value="">Choose your role...</option>
                                <option value="nurse">üë©‚Äç‚öïÔ∏è Nurse</option>
                                <option value="clinician">üë®‚Äç‚öïÔ∏è Clinician</option>
                                <option value="admin">‚öôÔ∏è Administrator</option>
                            </select>
                        </div>
                        <button type="button" onclick="performDemoLogin()" 
                                class="px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition transform hover:scale-105 shadow-lg">
                            <i class="fas fa-sign-in-alt mr-2"></i> Login
                        </button>
                    </div>
                </form>
            </div>

            <!-- Custom Login Section -->
            <div id="custom-section" class="form-section">
                <h3 class="text-lg font-semibold text-gray-900 mb-4 text-center">
                    <i class="fas fa-user-plus mr-2"></i>Create Account & Login
                </h3>

                <div class="mt-4 p-4 bg-purple-50 rounded-lg">
                    <p class="text-sm font-medium text-purple-900 mb-2">
                        <i class="fas fa-info-circle mr-1"></i>
                        Custom Login Instructions:
                    </p>
                    <ul class="text-xs text-purple-700 space-y-1">
                        <li>‚Ä¢ Enter your full name as username</li>
                        <li>‚Ä¢ Select your appropriate role from the dropdown</li>
                        <li>‚Ä¢ Create a secure password</li>
                        <li>‚Ä¢ Your account will be created automatically</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center mt-6 text-white">
            <p class="text-sm">
                ¬© 2024 SmartTriage AI. Powered by AI for Eldoret Hospitals
            </p>
        </div>
    </div>

    <script>
        // Tab switching
        function switchTab(tab) {
            // Hide all sections
            document.getElementById('demo-section').classList.remove('active');
            document.getElementById('custom-section').classList.remove('active');
            
            // Remove active class from all tabs
            document.getElementById('demo-tab').classList.remove('active');
            document.getElementById('custom-tab').classList.remove('active');
            
            // Show selected section and activate tab
            if (tab === 'demo') {
                document.getElementById('demo-section').classList.add('active');
                document.getElementById('demo-tab').classList.add('active');
            } else if (tab === 'custom') {
                document.getElementById('custom-section').classList.add('active');
                document.getElementById('custom-tab').classList.add('active');
            }
        }

        // Toggle password visibility for multiple fields
        function togglePassword(fieldId) {
            const passwordInput = document.getElementById(fieldId);
            const icon = passwordInput.nextElementSibling.querySelector('i');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }
        
        // Handle demo role change
        function handleDemoRoleChange() {
            const role = document.getElementById('demo-role').value;
            const loginButton = document.querySelector('button[onclick="performDemoLogin()"]');
            
            if (role) {
                loginButton.disabled = false;
                loginButton.textContent = 'Login as ' + role.charAt(0).toUpperCase() + role.slice(1);
            } else {
                loginButton.disabled = true;
                loginButton.textContent = 'Please select a role';
            }
        }

        // Demo login function for single form
        function performDemoLogin() {
            const role = document.getElementById('demo-role').value;
            
            if (!role) {
                alert('Please select a role before logging in');
                return;
            }
            
            demoLogin(role);
        }

        // Custom login function
        function customLogin() {
            const username = document.getElementById('custom-username').value.trim();
            const role = document.getElementById('custom-role').value;
            const password = document.getElementById('custom-password').value;
            
            if (!username || !role || !password) {
                alert('Please fill in all fields for custom login');
                return;
            }
            
            // Validate role
            if (!['nurse', 'clinician', 'admin'].includes(role)) {
                alert('Please select a valid role');
                return;
            }
            
            // Create form data
            const formData = new FormData();
            formData.append('username', username);
            formData.append('password', password);
            
            // Submit to custom login endpoint
            fetch('/auth/custom_login', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (response.ok) {
                    window.location.href = response.url;
                } else {
                    alert('Login failed. Please check your credentials.');
                }
            })
            .catch(error => {
                console.error('Login error:', error);
                alert('Login failed. Please try again.');
            });
        }

        // Demo login function for single form
        function demoLogin(role) {
            const formData = new FormData();
            
            // Set credentials based on role
            if (role === 'nurse') {
                formData.append('username', 'nurse');
                formData.append('password', 'nurse123');
            } else if (role === 'clinician') {
                formData.append('username', 'clinician');
                formData.append('password', 'clinician123');
            } else if (role === 'admin') {
                formData.append('username', 'admin');
                formData.append('password', 'admin123');
            }
            
            // Submit to login endpoint
            fetch('/auth/login', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (response.ok) {
                    window.location.href = response.url;
                } else {
                    alert('Login failed. Please check your credentials.');
                }
            })
            .catch(error => {
                console.error('Login error:', error);
                alert('Login failed. Please try again.');
            });
        }
    </script>
</body>
</html>
